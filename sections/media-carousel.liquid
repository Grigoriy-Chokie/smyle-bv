{%- liquid
  assign metaobject = section.settings.metaobject
  assign media_items = metaobject.images.value
  assign media_limit = 20

  assign has_bottom_splitter = section.settings.has_bottom_splitter
  assign padding_top = section.settings.padding_top
  assign padding_bottom = section.settings.padding_bottom
-%}

<div class="section-id-{{ section.id }} collection-slider-row {% if section.settings.color_scheme != 'default' %}use-color-scheme use-color-scheme--{{ section.settings.color_scheme }}{% endif %} {% if has_bottom_splitter %}collection--has-bottom-splitter{% endif %}
{% if padding_top %}top-padded-row--medium{% endif %}
{% if padding_bottom %}bottom-padded-row--medium{% endif %}

">
  <div class="container container--not-mobile{% if section.settings.full_width %} container--no-max{% endif %}">
    <carousel-slider class="carousel block collection-slider">

    <h2 class="hometitle h3 align-left has-paging slider-nav" {%- render 'animation-attrs', attrs: 'data-cc-animate data-cc-animate-delay="0.3s"' -%}>
        <button name="prev" class="slider-nav__btn has-ltr-icon">
            <span class="visually-hidden">{{ 'general.slider.previous' | t }}</span>
            {% render 'icon-chevron-left' %}
        </button>

        <span class="has-paging__title uppercase flex justify-{{ section.settings.title_alignment }} text-center">{{ section.settings.title | escape }}</span>
        
        <button name="next" class="slider-nav__btn has-ltr-icon">
            <span class="visually-hidden">{{ 'general.slider.next' | t }}</span>
            {% render 'icon-chevron-right' %}
        </button>
    </h2>

    <div class="collection-listing fade-in-up slider {% if section.settings.full_width %}slider--edge-peek{% endif %} slider--mobile-container-pad slider--no-scrollbar" {%- render 'animation-attrs', attrs: 'data-cc-animate' -%}>
      <div class="product-grid product-grid--per-row-{{ section.settings.grid }} product-grid--per-row-mob-{{ settings.prod_thumb_mob_per_row }} slider__grid product-grid--carousel">
        {%- liquid
          if section.settings.metaobject == blank
            for i in (1..media_limit)
                echo '<div class="slider__item">'
                    render 'onboarding-product-block', forloop: forloop
                echo '</div>'
            endfor
          else
            if settings.prod_thumb_shape == 'portrait-23'
              assign chosen_aspect_ratio = 0.67
            elsif settings.prod_thumb_shape == 'portrait-45'
              assign chosen_aspect_ratio = 0.8
            elsif settings.prod_thumb_shape == 'square'
              assign chosen_aspect_ratio = 1.0
            elsif settings.prod_thumb_shape == 'landscape-54'
              assign chosen_aspect_ratio = 1.25
            elsif settings.prod_thumb_shape == 'landscape-32'
              assign chosen_aspect_ratio = 1.50
            elsif settings.prod_thumb_shape == 'tallest'
              assign chosen_aspect_ratio = 99
              for media in media_items limit: media_limit
                if media.preview_image.aspect_ratio < chosen_aspect_ratio
                  assign chosen_aspect_ratio = media.preview_image.aspect_ratio
                endif
              endfor
            else
              assign chosen_aspect_ratio = 0
              for media in media_items limit: media_limit
                if media.preview_image.aspect_ratio > chosen_aspect_ratio
                  assign chosen_aspect_ratio = media.preview_image.aspect_ratio
                endif
              endfor
            endif

            for media in media_items limit: media_limit
                echo '<div class="slider__item">'
                    render 'media', media: media, product: product, min_aspect_ratio: chosen_aspect_ratio, loading: 'lazy'
                echo '</div>'
            endfor
          endif
        -%}
      </div>
    </div>
    </carousel-slider>
  </div>
</div>


{% schema %}
{
  "name": "Media Carousel (Metaobj)",
  "class": "section-media-carousel",
  "disabled_on": {
    "templates": [
      "password"
    ],
    "groups": [
      "aside"
    ]
  },
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Heading",
      "default": "Gallery"
    },
    {
      "type": "select",
      "id": "title_alignment",
      "label": "Title position",
      "default": "start",
      "options": [
        {
          "value": "start",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "end",
          "label": "Right"
        }
      ]
    },
    {
      "type": "metaobject",
      "metaobject_type": "ugc_image_carousels",
      "id": "metaobject",
      "label": "Metaobject (Media)"
    },
    {
      "type": "checkbox",
      "id": "has_bottom_splitter",
      "label": "Enable section splitter below current section.",
      "default": false
    },
    {
      "type": "range",
      "id": "grid",
      "label": "Products per row",
      "min": 2,
      "max": 5,
      "step": 1,
      "default": 4
    },
    {
      "type": "select",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "default",
      "options": [
        {
          "value": "default",
          "label": "Default"
        },
        {
          "value": "1",
          "label": "1"
        },
        {
          "value": "2",
          "label": "2"
        },
        {
          "value": "3",
          "label": "3"
        },
        {
          "value": "4",
          "label": "4"
        }
      ]
    },
    {
      "id": "full_width",
      "type": "checkbox",
      "label": "Full page width",
      "default": true
    },
    {
      "type": "header",
      "content": "Spacing"
    },
    {
      "id": "padding_top",
      "type": "checkbox",
      "label": "Padding top"
    },
    {
      "id": "padding_bottom",
      "type": "checkbox",
      "label": "Padding bottom"
    }
  ],
  "presets": [
    {
      "name": "Media Carousel (Metaobj)",
      "settings": {
        "title": "Gallery"
      }
    }
  ]
}
{% endschema %}
